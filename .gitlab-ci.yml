default:
  before_script:
    - apt-get update -yq --allow-releaseinfo-change
    - which python3 || apt-get install -y python3
    - which pip3 || apt install -y python3-pip
    # install poetry
    - pip3 install "poetry>=2.1.0"
    - pip3 install "poetry-dynamic-versioning>=1.1.0,<2.0.0"

stages:
#  - test
  - publish

publish:package:
  stage: publish
  script:
    - poetry config repositories.wegc $PYPI_SERVER
    - poetry config http-basic.wegc $PYPI_USERNAME $PYPI_PASSWORD
    - poetry build
    - poetry publish -r wegc
  only:
    - tags
